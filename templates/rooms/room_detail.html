{% extends "base.html" %}
{% load is_booked %}

{% block page_title %}
    {{room.name}}
{% endblock page_title %}

{% block content %}

    <div class="flex container mb-20 border-2 border-gray-700 max-w-full h-75vh">
        <div class="border border-gray-500 w-1/2 h-full bg-cover bg-center" style="background-image: url({{room.get_first_photo}});"></div>
        <div class="flex flex-wrap w-1/2 h-full">
            {% for photo in room.get_four_sub_photo %}
                <div class="border border-gray-500 w-1/2 h-auto bg-cover bg-center" style="background-image: url({{photo.file.url}});"></div>
            {% endfor %}
        </div>
    </div>

    <div class="flex justify-between w-3/4 mx-auto border-b border-gray-300">
        <div class="w-7/12">
            <div class="flex justify-between mb-5">
                <div>
                    <h4 class="text-2xl font-medium mb-1">{{room.name}}</h4>
                    <h6 class="text-gray-700 text-sm font-light">{{room.city}}</h6>
                </div>
                <a class="flex flex-col items-center" href="{{room.host.get_absolute_url}}">
                    {% include "mixins/user_avatar.html" with user=room.host h_and_w='w-16 h-16' text='text-2xl' %}
                    <span class="mt-1 text-sm font-light">{{room.host.first_name}}{{room.host_last_name}}</span>
                </a>
            </div>
            <a class="flex justify-center items-center rounded-md p-2 w-1/3 text-white font-medium bg-red-400" href="{% url 'lists:save-room' room.pk %}">Save to Favorite</a>
            <div class="border-section flex">
                <span class="mr-5">{{room.room_type}}</span>
                <span class="mr-5">{{ room.beds }} bed{{ room.beds|pluralize }}</span>
                <span class="mr-5">{{room.bedrooms}} bedroom{{room.bedrooms|pluralize}}</span>
                <span class="mr-5">{{room.baths}} bath{{room.baths|pluralize}}</span>
                <span class="mr-5">{{room.guests}} guest{{room.guests|pluralize}}</span>
            </div>
            <div class="border-section flex flex-col">
                <div class="flex mb-5">
                    <i class="fas fa-home mt-1 mr-4 text-2xl"></i>
                    <div class="flex flex-col">
                        <h4 class="text-gray-600 font-semibold">Whole House</h4>
                        <span>This is {{room.room_type}} house.</span>
                    </div>
                </div>
                <div class="flex mb-5">
                    <i class="fas fa-bath mt-1 mr-4 text-2xl "></i>
                    <div class="flex flex-col">
                        <h4 class="text-gray-600 font-semibold">Enhance Cleanliness</h4>
                        <span>A host who has agreed to follow Shigatsubnb's enhanced five-step cleaning process.</span>
                    </div>
                </div>
                {% if room.host.superhost %}
                    <div class="flex mb-5">
                        <i class="fas fa-award mt-1 mr-4 text-2xl"></i>
                        <div class="flex flex-col">
                            <h4 class="text-gray-600 font-semibold">{{room.host.first_name}}{{room.host.last_name}} is a Superhost</h4>
                            <span>Superhosts are highly experienced and highly rated hosts who are committed to ensuring that their guests stay comfortably in their accommodation.</span>
                        </div>
                    </div>
                {% endif %}
                <div class="flex">
                    <i class="fab fa-galactic-republic mt-1 mr-4 text-2xl"></i>
                    <div class="flex flex-col">
                        <h4 class="text-gray-600 font-semibold">Refund Policy</h4>
                        <span>If canceled up to 30 days before check-in, a full refund will be given.</span>
                    </div>
                </div>
                {% if room.host.house_rules %}
                    <div class="flex">
                        <i class="fas fa-ruler-combined mt-1 mr-4 text-2xl"></i>
                        <div class="flex flex-col">
                            <h4 class="text-gray-600 font-semibold">House Rules</h4>
                            <ul>
                                {% for rule in rooms.house_rules %}
                                    <li>{{rule}}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                {% endif %}
            </div>
            <div class="border-section">
                <h4 class="font-semibold text-lg mb-5">Room Description</h4>
                <p>{{room.description}}</p>
            </div>
            <div class="border-section">
                <h4 class="font-semibold text-lg mb-5">Amenity</h4>
                <ul>
                    {% for idx, amenity in room.get_enumerate_amenity %}
                        {% if idx != room.get_amenity_count %}
                            <li class="pb-5">{{amenity}}</li>
                        {% else %}
                            <li>{{amenity}}</li>
                        {% endif %} 
                    {% endfor %}
                </ul>
            </div>
            <div class="py-10">
                <h4 class="font-semibold text-lg mb-5">Facility</h4>
                <ul>
                    {% for idx, facility in room.get_enumerate_facility %}
                        {% if idx != room.get_facility_count %}
                            <li class="pb-5">{{facility}}</li>
                        {% else %}
                            <li>{{facility}}</li>
                        {% endif %}
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="w-1/3">
            {% if room.host == user %}
                <a class="sticky top-28 btn-link block" href="{% url 'rooms:edit' room.pk %}">Edit Room</a>
            {% else %}
                {% if not request.session.is_hosting %}
                    <div class="sticky top-28 mb-20">
                        {% for calendar in room.get_calendars %}
                            <div class="mb-20">
                                <span class="block mb-8 text-center text-lg font-semibold">{{calendar.get_month}} / {{calendar.year}}</span>
                                <div class="grid grid-cols-7 gap-2 text-center mb-4">
                                    {% for day in calendar.days %}
                                        <span>{{day}}</span>
                                    {% endfor %}
                                </div>
                                <div class="grid grid-cols-7 gap-1 text-center">
                                    {% for day in calendar.get_days %}
                                        {% is_booked room day as is_booked_bool %}
                                        {% if day.number != 0 %}
                                            {% if day.past %}
                                                <span class="text-center text-gray-300">{{day}}</span>
                                            {% elif is_booked_bool %}
                                                <span class="text-center text-gray-500 line-through">{{day}}</span>
                                            {% else %}
                                                <a href="{% url 'reservations:create' room.pk day.year day.month day.number %}" class="text-center border-gray-500 border border-opacity-0 rounded-full hover:border-opacity-100 cursor-pointer">{{day}}</a>
                                            {% endif %}
                                        {% else %}
                                            <span class="text-center"></span>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                {% endif %}
            {% endif %}
        </div>
    </div>

    <div class="flex flex-col mx-auto border-b border-gray-300 py-10 mb-56 w-3/4">
        <div class="w-full">
            <h4 class="font-medium text-2xl mb-5">Reviews</h4>
            <div class="flex items-center">
                <div>
                    <i class="fas fa-star text-lg text-red-500 mr-2"></i>
                    <span class="text-lg font-semibold">{{room.total_rating}}</span>
                </div>
                <div class="h-4 w-px bg-gray-400 mx-5"></div>
                <div>
                    <span class="font-semibold text-lg">{{room.reviews.count}}</span>
                    <span>review{{room.reviews.count|pluralize}}</span>
                </div>
            </div>
        </div>
        <div class="flex flex-wrap w-full py-10">
            {% for review in room.reviews.all %}
                <div class="w-1/2 mb-5 pr-5">
                    <div class="flex">
                        {% include "mixins/user_avatar.html" with user=review.user h_and_w='w-14 h-14' text='text-xl' %}
                        <div class="flex flex-col ml-5 pb-5">
                            <h4 class="text-lg font-semibold">{{review.user.first_name}}{{review.user.last_name}}</h4>
                            <span class="text-sm text-gray-400 font-medium">{{review.created}}</span>
                        </div>
                    </div>
                    <p class="max-h-32 overflow-hidden">{{review.review}}</p>
                </div>
            {% endfor %}
        </div>
    </div>

{% endblock content %}